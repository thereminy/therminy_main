<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Theremin-y</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main>
        <h1>Theremin-y</h1>
        <audio id="sound" src="" type="audio/wav" controls></audio>
        <input id="user" type="text" name="username" placeholder="Username" required>
        <button onclick="updateAudio()">Get Sound</button>
        <h1>Songs</h1>
        <ul id="songs">
            <!-- Populate songs  -->
        </ul>
    </main>
    <script>
        const songs = document.getElementById("songs");

        function updateAudio() {
            let request = new XMLHttpRequest();
            let user = document.getElementById("user").value;
            if (user === "") {
                alert("Please fill out a username");
            } else {
                request.open('GET','server.py?user=' + user);
                request.responseType = 'text';
        
                request.onload = function() {
                    console.log(JSON.parse(request.response));
                    populateSongs(JSON.parse(request.response));
                };
                request.send();
                }
        };
    
        function getSound(base64_decoded) {
            document.getElementById('sound').setAttribute('src', 'data:audio/wav;base64, ' + base64_decoded);
        }

        function populateSongs(response){
            resetSongs();
            let count = 1;
            for (const base_64 of response){
                let song = document.createElement("li");
                let name = document.createTextNode("song"+count);
                song.appendChild(name);
                song.id = base_64;
                songs.append(song);
                song.addEventListener('click', () => {
                    document.getElementById('sound').setAttribute('src', 'data:audio/wav;base64, ' + base_64);                   
                })
                count+=1;
            }
        }

        function resetSongs(){
            while (songs.hasChildNodes()) {
                songs.removeChild(songs.lastChild);
            }
        }
    
      </script>
</body>
</html>
